{"version":3,"sources":["../src/index.ts"],"sourcesContent":["#!/usr/bin/env node\n\nimport spawn from \"cross-spawn\";\nimport * as fs from \"fs\";\nimport https from \"https\";\nimport path from \"path\";\n\nimport { input, select } from \"@inquirer/prompts\";\n\nconst templates = [\n    {\n        value: \"react-app\",\n        description: \"React app using Dojo\",\n    },\n    {\n        value: \"react-phaser-example\",\n        description: \"React/Phaser app using Dojo\",\n    },\n    {\n        value: \"react-pwa-app\",\n        description: \"React Progressive Web Apps using Dojo\",\n    },\n    {\n        value: \"react-threejs\",\n        description: \"React Threejs using Dojo\",\n    },\n];\n\nrun();\n\nasync function run() {\n    try {\n        const { template, projectName } = await prompt();\n\n        // Create the main project directory\n        const projectPath = path.join(process.cwd(), projectName);\n        fs.mkdirSync(projectPath, { recursive: true });\n\n        // Create client and dojo-starter directories inside the main project directory\n        const clientPath = path.join(projectPath, 'client');\n        const dojoStarterPath = path.join(projectPath, 'dojo-starter');\n        fs.mkdirSync(clientPath, { recursive: true });\n        fs.mkdirSync(dojoStarterPath, { recursive: true });\n\n        // clone template using degit into client directory\n        console.log(`Downloading ${template} into client directory...`);\n        spawn.sync(\"npx\", [\n            \"degit\",\n            `dojoengine/dojo.js/examples/react/${template}`,\n            clientPath, // Cloning directly into the client directory\n        ]);\n\n        // Ensure the client directory exists before rewriting package.json\n        if (!fs.existsSync(clientPath)) {\n            throw new Error(`Client directory not found at ${clientPath}`);\n        }\n\n        // rewrite package.json in client directory\n        await rewritePackageJson(projectName);\n\n        // clone dojo-starter into the dojo-starter directory\n        console.log(`Downloading dojo-starter...`);\n        spawn.sync(\"npx\", [\"degit\", `dojoengine/dojo-starter`, dojoStarterPath]);\n        \n        console.log(\"Congrats! Your new project has been set up successfully.\\n\");\n        console.log(`Navigate into your project directory with:\\n  cd ${projectName}\\n`);\n        console.log(\"You can then build the starter and run the client.\\n\");\n        console.log(\"For detailed instructions, follow the README here:\\n\");\n\n        console.log('https://book.dojoengine.org/cairo/hello-dojo');\n\n    } catch (e) {\n        console.error(`Error: ${e}`);\n    }\n}\n\nasync function rewritePackageJson(projectName: string) {\n    // The package.json is expected to be in the 'client' subdirectory\n    const clientPath = path.join(process.cwd(), projectName, 'client');\n    process.chdir(clientPath);\n\n    const packageJsonPath = path.join(\"package.json\");\n    // Check if package.json exists before reading it\n    if (!fs.existsSync(packageJsonPath)) {\n        throw new Error(`package.json not found in ${clientPath}`);\n    }\n    const packageJson = JSON.parse(fs.readFileSync(packageJsonPath, \"utf-8\"));\n    const latestVersion = await getLatestVersion();\n\n    // rename using projectName\n    packageJson.name = projectName;\n\n    // rewrite all link:dojo-packages/packages/... with latest version\n    for (let dep of Object.keys(packageJson.dependencies)) {\n        if (\n            dep.startsWith(\"@dojoengine\") &&\n            packageJson.dependencies[dep].startsWith(\"workspace:\")\n        ) {\n            packageJson.dependencies[dep] = latestVersion;\n        }\n    }\n\n    fs.writeFileSync(packageJsonPath, JSON.stringify(packageJson, null, 2));\n}\n\nasync function prompt(): Promise<{ template: string; projectName: string }> {\n    const template = await select({\n        message: \"Select a template\",\n        choices: templates,\n    });\n\n    const projectName = await input({\n        message: \"Project name \",\n        validate: (input: string) => {\n            if (/^([A-Za-z\\-\\_\\d])+$/.test(input)) return true;\n            else\n                return \"Project name may only include letters, numbers, underscores and hashes.\";\n        },\n        default: template,\n    });\n\n    return { template, projectName };\n}\n\nasync function getLatestVersion(): Promise<string> {\n    return new Promise((resolve, reject) => {\n        https\n            .get(\n                \"https://registry.npmjs.org/-/package/@dojoengine/core/dist-tags\",\n                (res) => {\n                    if (res.statusCode === 200) {\n                        let body = \"\";\n                        res.on(\"data\", (data) => (body += data));\n                        res.on(\"end\", () => {\n                            resolve(JSON.parse(body).latest);\n                        });\n                    } else {\n                        reject();\n                    }\n                }\n            )\n            .on(\"error\", () => {\n                reject();\n            });\n    });\n}\n"],"mappings":"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","names":["input"]}